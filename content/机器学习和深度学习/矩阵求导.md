---
title: 
author: team317
Date: 2022-04-16
categories:  
  - "机器学习和深度学习"
tags:  
  - "机器学习"
---

很多机器学习算法都需要求解最值，比如最小二乘法求解样本空间相对拟合曲线的最短距离，最值的求解往往通过求导来计算，而机器学习中又常用矩阵来处理数据，所以很多时候会涉及到矩阵的求导。矩阵求导就像是线性代数和微积分的结合，但两者结合后规则又有些不同。<!--more-->

对于矩阵求导，基本的规则可以参照[【手推机器学习】矩阵求导--合集](https://www.bilibili.com/video/BV1xk4y1B7RQ?share_source=copy_web)，最需要注意的就是矩阵或者向量的shape以及求导结果的shape。
![](https://gitee.com/Team317/pictures/raw/master/images/MommyTalk1650085632316.png)
矩阵求导中也具有链式求导法则，下面是一个相关的例子，注意矩阵的形状变化：
![](https://gitee.com/Team317/pictures/raw/master/images/20220416104107.png)

很多时候，为了使结果更简洁，求导的结果也会用矩阵来表示，下面是常用的求导公式：
![](https://gitee.com/Team317/pictures/raw/master/images/20220416104525.png)

![](https://gitee.com/Team317/pictures/raw/master/images/MommyTalk1650094177004.png)

$$
\begin{array}{c}
最朴素的公式的推导过程就是带入具体的矩阵按照视频中介绍的方式逐步的推导，\\
这个过程很繁琐，但它的结果可能很简洁，就像上面给出的这些求导公式那样。\\
为了更好的理解这些公式，下面给出几个常用的公式的推导过程:\\
第一个公式是\frac{\partial x^{T} A}{\partial x} = \frac{\partial A^{T} x}{\partial x} = A，推导过程如下：
\\\\
\frac{\partial x^{T} A}{\partial x} = \frac{\partial A^{T} x}{\partial x}
\qquad\qquad\qquad\qquad\qquad\qquad
\\\\

\qquad\quad\space = {\left[\begin{array}{}
\frac{\partial \sum_{i = 1}^{m} A_{i} x_{i}}{\partial x_{1}} \
\frac{\partial \sum_{i = 1}^{m} A_{i} x_{i}}{\partial x_{2}} \
\cdots \
\frac{\partial \sum_{i-1}^{m} A_{i} x_{i}}{\partial x_{m}}
\end{array}\right] } 
\\\\
\qquad\qquad = \left[\begin{array}{c}
A_{1} \
A_{2} \
\cdots \
A_{m} 
\end{array}\right] \qquad\quad\space\qquad\quad\space\qquad\space\space\space
\\\\
\qquad = A\qquad\quad\space\qquad\quad\space\qquad\quad\space\qquad\quad\space
\\\\
第二个公式是\frac{\partial x^{T} B x}{\partial x} = \left(A^{T}+A\right)x，推导过程如下：\\\\

\frac{\partial x^{T} B x}{\partial x} = \left[\begin{array}{c}
\frac{\partial \sum_{i = 1}^{m} \sum_{j-1}^{m} B_{i j} x_{i} x_{j}}{\partial x_{1}} \\
\frac{\partial \sum_{i = 1}^{m} \sum_{j = 1}^{m} B_{i j} x_{i} x_{j}}{\partial x_{2}} \\
\cdots \\ \\
\frac{\partial \sum_{i = 1}^{m} \sum_{j-1}^{m} B_{i j} x_{i} x_{j}}{\partial x_{m}}

\end{array}\right] \qquad \qquad\qquad \qquad\\ \\ = \left[\begin{array}{c}
\sum_{i = 1}^{m} B_{i 1} x_{i}+\sum_{j = 1}^{m} B_{1 j} x_{j} \\
\sum_{i = 1}^{m} B_{i 2} x_{i}+\sum_{j = 1}^{m} B_{2 j} x_{j} \\
\cdots \\
\sum_{i = 1}^{m} B_{i m} x_{i}+\sum_{j = 1}^{m} B_{m j} x_{j}
\end{array}\right] \\ \\
\space\space\space\space = \left[\begin{array}{c}
\sum_{i = 1}^{m} B_{i 1} x_{i} \\
\sum_{i = 1}^{m} B_{i 2} x_{i} \\
\cdots \\
\sum_{i = 1}^{m} B_{i m} x_{i}
\end{array}\right]+\left[\begin{array}{c}
\sum_{j = 1}^{m} B_{1 j} x_{j} \\
\sum_{j = 1}^{m} B_{2 j} x_{j} \\
\cdots \\
\sum_{j = 1}^{m} B_{m j} x_{j}
\end{array}\right]
\\ \\

\qquad = \left[\begin{array}{cccc}
B_{11} & B 21 & \cdots & B m 1 \\
B_{12} & B 22 & \cdots & B m 2 \\
\vdots & \vdots & \ddots & \vdots \\
B_{1 m} & B 2 m & \cdots & B m m
\end{array}\right]\left[\begin{array}{c}
x_{1} \\
x_{2} \\
\vdots \\
x_{m}
\end{array}\right]\\ \\

\qquad
+\left[\begin{array}{cccc}
B_{11} & B 12 & \cdots & B 1 m \\
B_{21} & B 22 & \cdots & B 2 m \\
\vdots & \vdots & \ddots & \vdots \\
B_{m 1} & B m 2 & \cdots & B m m
\end{array}\right]\left[\begin{array}{c}
x_{1} \\
x_{2} \\
\vdots \\
x_{m}
\end{array}\right]\\ \\ = \left(A^{T}+A\right) x = \left(A+A^{T}\right) x \qquad
\\\\
在常用公式的基础上，通过矩阵的分配律可以化简求导过程，
\\
例如最小二乘法中方差函数对参数的求导，这里给出两种方式：\\\\
方式一：\\\\
\begin{matrix}

\frac{dL(w)}{dw} = \frac{ d[(y-X*w)^T(y-X*w)] } {dw}
\\\\ = \frac{d[(y^T-w^T*X^T)(y-X*w)]}{dw}
\\\\ = \frac{d(y^T*y-w^T*X^T*y-y^T*X*w+w^T*X^T*X*w)}{dw} 
\\\\

其中w^T*X^T*y和y^T*X*w都是标量且互为转置，因而两者相等，有：
\\\\ = -\frac{d(2y^T*X*w}{dw} +\frac{w^T*X^T*X*w}{dw}
\\\\

结合上面的两个公式\frac{da^Tb}{da} = b^T和\\
\frac{da^TAa}{da} = A^Ta+A*a = 2A*a(当A为对称阵)，有：
\\\\ = -2X^T*y+2X^T*X*w
\\\\

令上式为0，得：
\\\\
w = (X^T*X)^{-1}X^T*y

\end{matrix}

\\\\
方式二：
\\\\
\begin{array}{c}
令e(w) = y-X*w,则L(e) = e^Te
\\\\
由链式求导法则，有：\\
\frac{dL}{dw} = \frac{dL}{de}\frac{de}{dw}
\\\\ = 2e^T*(-X)
\\\\ = -2(y-X*w)^T*X
\\\\ = -2y^T*X+2w^T*X^T*X
\\\\
同样令上式为0，得:
\\\\
w^T = y^T*X*(X^T*X)^{-1}
\\\\
由X^T*X为对称矩阵有[(X^T*X)^{-1}]^T = (X^T*X)^{-1}，得：
\\\\
w = (X^T*X)^{-1}X^T*y
\end{array}
\end{array}
$$