---
title: 用==比较保存相同字符串的两个String对象，返回结果为false
author: team317
Date: 2022-03-17
categories:  
  - "Java笔记"
tags:  
  - "Java"
---
在下面的代码中，`str1`和`str2`中保存相同的字符串"hello"，但最终输出结果为`Is str1==str2: false`，为什么==的操作结果返回为`false`？这个问题并不难，但可以把一些知识点串联起来。
```java
String str1 = "hello";
String str2 = "hello";
System.out.println("Is str1==str2: ", str1==str2);
```
<!--more-->
`Java`中的字符串存放在公共的存储池中，每个字符串都是不可变的的，在存储池中只保存一份，所以在上面的代码中，`str1`和`str2`保存的同一份的字符串，那么为什么`str1==str2`的结果依然为`false`呢？

首先从`==`运算符入手，`==`用来比较两个变量中保存的值是否相同，由于`Java`中不允许用户重载运算符，所以`==`的含义不会改变，在`str1==str2`中会比较`str1`和`str2`中保存的值是否相同。乍一看，`str1`和`str2`保存同一份字符串，两者的值一定是相同的。

理解这个问题的关键是**区分实例字段的值和类变量的值。**

`Java`中的变量可分为两类，一类是基本类型变量，这类变量中存放的是值；另一类是类变量，用于保存非基本类型创建的引用，可以理解为对象的位置。

`str1`和`str2`是类对象，其中保存的是String对象的引用。在String类型中，字符串保存在`value`字段中，这是一个字符数组。所以`str1`和`str2`的`value`字段会保存相同的字符串。但`str1`和`str2`对应的是两个不同的对象，两者在内存中的位置并不相同，所以`str1`和`str2`的值也就不同了。使得返回结果为`false`。

在什么时候`str1==str2`的结果会为`true`呢？当`str1`和`str2`指向同一个对象时，两者会完全一样，例如：
```java
String str1 = "hello";
String str2 = str1;
```
在python中，`str2`称作`str1`的别名，对`str2`的操作等价于对`str1`的操作。但是由于String和基本类型一样都是不可变的（保存不同字符串的两个String对象的hash值不同），当改变`str2`中保存的字符串时，例如将其赋值为"Hello"，将会生成一个新的字符串对象并赋给`str2`，使得str2指向另一个字符串对象，导致`str1==str2`的结果为`false`。

要比较两个字符串对象中保存的字符串是否相等，需使用`equals`方法，它会逐个比对字符串中的字符，当对应位置上的字符全部相同时返回`true`。